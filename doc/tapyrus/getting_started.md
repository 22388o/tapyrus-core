## Introduction

As Tapyrus is a *federated network*, multiple main networks overseen by one federation each would be online. Each network could be using tapyrus to deploy a blockchain application for use in a different contexts. A network can be identified by looking at the network parameters from v0.4.0 onwards(using the genesis block and netowrk magic bytes upto version v0.3.0). Before running a node double check the network parameters and make sure that the node connects to the right network.


### Components of a Tapyrus network
Tapyrus network has different kinds of nodes, this is a minimal list at the time of release:

| Node type |    How many? | Purpose |
| :---: | :---: | :---: |
|Tapyrus Signer | min 3, max 15  | A network of signers that collects Unapproved transactions from the Tapyrus network and creates a block. |
| Tapyrus Core  | min 1, unbounded  | Tapyrus full node implementation |
| Tapyrus Seeder | unbounded  | DNS seeder for configuring Tapyrus network |
| Tapyrus SPV | unbounded | A lightweight client implementation for Tapyrus blockchain |
| Tapyrus Explorer| unbounded | Tapyrus blockchain explorer |
| Electrs Tapyrus| unbounded | Tapyrus blockchain index server |

### Tapyrus network parameters
Following parameters are unique to each tapyrus network

**Genesis block**  
In tapyrus, genesis block is not embedded into the software. It is an external file generated using a utility provided by tapyrus called tapyrus-genesis and signed by the federation of tapyrus-signers. Each tapyrus network has a unique genesis block. 

**Aggregate public key**  
The genesis block contains the "aggregate public key" of the federation. It is generated by the Tapyrus-signer network at startup using verifiable secret sharing scheme. It is used by each tapyrus-core node to validate the threshold signature in the block proof and accept the block.

_TODO: describe the other network parameters_

## FAQ
* [How to build tapyrus?](https://github.com/chaintope/tapyrus-core/new/master/doc/tapyrus#how-to-build-tapyrus)  
* [How to start tapyrus in regtest mode?](https://github.com/chaintope/tapyrus-core/new/master/doc/tapyrus#how-to-start-tapyrus-in-regtest-mode)
* [How to start a node on tapyrus testnet?](https://github.com/chaintope/tapyrus-core/new/master/doc/tapyrus#how-to-start-a-node-on-tapyrus-testnet)
* [How to start a new tapyrus network?](https://github.com/chaintope/tapyrus-core/new/master/doc/tapyrus#how-to-start-a-new-tapyrus-network)

### How to build tapyrus? 

Tapyrus is currently supported on two platforms, Linux and Mac Os. 
- To build tapyrus-core  
Please follow the instructions in [build-unix.md](..//build-osx.md) and [build-osx.md](../build-osx.md) to build tapyrus-core compoenets
- To build tapyrus-signer   
Please follow the instructions in [build tapyrus-signer](https://github.com/chaintope/tapyrus-signer#building-the-source) to build tapyrus-signer
### How to start tapyrus in regtest mode?

One Tapyrus-core node can be started in regtest mode for testing purposes. In this case generate a new genesis block using tapyrus-genesis utility. 

### How to start a node on tapyrus testnet?

Tapyrus test public RPC Endpoint is *54.65.133.45:12377*
```$ bitcoin-cli -testnet -rpcconnect=54.65.133.45 -rpcuser=user -rpcpassword=pass getblockchaininfo```

Create data directory
```$ sudo mkdir /var/lib/tapyrus```

Create a configuration file 'tapyrus.conf' with the following content

```
testnet=3
txindex=1
server=1
rest=1
rpcuser=user
rpcpassword=pass
rpcbind=0.0.0.0
rpcallowip=172.16.2.0/24
```

Create 'genesis.dat' in data dir with the following contect

```
0100000000000000000000000000000000000000000000000000000000000000000000002e4533a0ccb1c1b83a641ce00656d3d234e362ab2ce0d6d69eaaba1edceb9e962f69b65cb127339d5d8da08d50f6d4deb37b46157123dbe5fb0a30a641af68e70c3d285d0346304402201e9de308c52cfc760c9eb5a1638857563c39791a77bd3b4c53dcd26b4d02e8480220542963fe20dbedd31c609f8393cb68e4b80c4e849fcddf7a0a2dddaac4ce2e134630440220295288205c39d933dd7c236011857cf3b0147e226154afc5c44421a38cb0a77102202c580fdf814904ed3f17fce8f545ba66aa3ebd9a00eb7205371ee3de895e2a0346304402200f9301b705c64a5fb5cb9ecb8cf4498291142b93491cb560e36db6145f60d6e002200572b51df4e1397340a1487f9f8b35e07730055a2d4d9a83e0954ff22a8bc599010100000001000000000000000000000000000000000000000000000000000000000000000000000000240102210276d7a1b83fd97b8751d2b82e1f7a89dcd23a5b3f5cc2798083ad6f775018102effffffff0100f2052a010000001976a914a941c2ccebe78a5a1348dddd42362b588cb563b588ac00000000
```

Before running, it's recommended that you create an RPC configuration file.

    echo -e "rpcuser=bitcoinrpc\nrpcpassword=$(xxd -l 16 -p /dev/urandom)" > "/Users/${USER}/Library/Application Support/Tapyrus/tapyrus.conf"

    chmod 600 "/Users/${USER}/Library/Application Support/Tapyrus/tapyrus.conf"


Start 'tapyrusd' using the following command.

```/usr/local/bin/tapyrusd -daemon -datadir=/var/lib/tapyrus -conf=/etc/tapyrus/tapyrus.conf```


Verify the progress of Initial block download in the new node using debug.log


### How to start a new tapyrus network?

A minimum functional tapyrus network needs 3 Tapyrus-signers and 1 Tapyrus-core node.  Following are the steps in launching a new Tapyrus-network:   
1 Create a new genesis block using Tapyrus-genesis utility.  
2 Start Tapyrus-signer network.  
3 Sign the genesis block using the signer network.   
4 Start Tapyrus-core    
